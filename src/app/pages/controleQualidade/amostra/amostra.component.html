<div class="menu">
    <ul nz-menu nzMode="horizontal" style="overflow-x: auto; white-space: nowrap; background-color:#f2f2f2;height: 40px;box-shadow: 2px 0 6px ; ">
        <li nz-menu-item nzMatchRouter="#">
            <a style="font-size: 13px;" routerLink="/welcome/controleQualidade/dashControle">Início</a>
        </li>
        <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-submenu nzTitle="Cadastros "  style="font-size: 13px; ">
            <ul>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/tipoEnsaio">Tipo de Ensaio</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/variavel">Variáveis de Ensaio</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/ensaio" >Ensaio</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/calculoEnsaio" >Cálculo de Ensaio</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/plano" >Plano de Análise</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/tipoAmostra" >Tipo de Amostra</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/produtoAmostra" >Produto de Amostra</a>
                </li>
                <li *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])" nz-menu-item  nzMatchRouter>
                    <a routerLink="/welcome/controleQualidade/garantia" >Garantias</a>
                </li>
            </ul>
        </li >
        <li nz-menu-item nzMatchRouter="#" *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])">
            <a style="font-size: 13px;" routerLink="/welcome/controleQualidade/amostra">Amostras</a>
        </li>

        <li nz-menu-item nzMatchRouter="#" *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])">
            <a style="font-size: 13px;" routerLink="/welcome/controleQualidade/ordem">Ordens de Serviço</a>
        </li>

        <li nz-menu-item nzMatchRouter="#" *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])">
            <a style="font-size: 13px;" routerLink="/welcome/controleQualidade/arquivo">Banco de Análises</a>
        </li>

        <li nz-menu-item nzMatchRouter="#" *ngIf="hasGroup(['Admin','Master','LabGestor','LabOp'])">
            <a style="font-size: 13px;">Banco de Relatórios</a>
        </li>
    </ul>
</div>
<div class="container flex flex-column align-items-center mb-4">
    <div class="containerInterno w-12">
        <div @swipeAnimation>
            <div class="form-geral flex flex-column gap-3 w-12">
                <div class="fg1 flex flex-column w-12 align-items-center">
                    <p-card class="card w-12 text-center">
                        <ng-template #header>
                            <div class="header titulo-info w-full text-center">
                                <h2>Amostras</h2>
                            </div>
                        </ng-template>
                        <p-stepper [(value)]="activeStep" [linear]="true">
                            <p-step-list>
                                <p-step [value]="1">
                                    <ng-template #content let-activateCallback="activateCallback" let-value="value">
                                        <button pButton size="large" severity="info" [rounded]="true" (click)="activateCallback()">
                                            <span [ngClass]="
                                            {
                                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                                'border-surface': value > activeStep
                                            }">
                                                <i class="pi pi-tags"></i>
                                            </span>
                                        </button>
                                    </ng-template>
                                </p-step>
                    
                                <p-step [value]="2">
                                    <ng-template #content let-activateCallback="activateCallback" let-value="value">
                                        <button pButton size="large" severity="info" [rounded]="true" (click)="activateCallback()">
                                            <span [ngClass]="
                                            {
                                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                                'border-surface': value > activeStep
                                            }">
                                                <i class="pi pi-print"></i>
                                            </span>
                                        </button>
                                    </ng-template>
                                </p-step>

                                <p-step [value]="3">
                                    <ng-template #content let-activateCallback="activateCallback" let-value="value">
                                        <button pButton size="large" severity="info" [rounded]="true" (click)="activateCallback()">
                                            <span [ngClass]="
                                            {
                                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                                'border-surface': value > activeStep
                                            }">
                                                <i class="pi pi-clipboard"></i>
                                            </span>
                                        </button>
                                    </ng-template>
                                </p-step>
                    
                                
                            </p-step-list>

                            <p-step-panels>
                                <p-step-panel [value]="1">
                                    <ng-template #content let-activateCallback="activateCallback">
                                        <div class="step1">
                                            <form [formGroup]="registerForm" title="Cadastrar nova amostra" class="flex flex-column gap-4">
                                                <div class="form-geral flex flex-column gap-3 w-12 lg:flex-row" @swipeAnimation>
                                                    <!--CARD 1-->
                                                    <div class="bloco w-4 text-center">
                                                            <div class="titulo titulo-info">
                                                                Informações Gerais
                                                            </div>    
                                                        <div class="flex flex-column w-12 align-items-center gap-3 lg:w-12">
                    
                                                            <div class="w-11">
                                                                <p-floatLabel variant="on">
                                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                                        formControlName="dataEntrada" dateFormat="dd/mm/yy"
                                                                        inputId="float-label" [showIcon]="true">
                                                                    </p-datepicker>
                                                                    <label for="float-label">Data de Entrada</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatLabel variant="on">
                                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                                        formControlName="dataColeta" dateFormat="dd/mm/yy"
                                                                        inputId="float-label" [showIcon]="true">
                                                                    </p-datepicker>
                                                                    <label for="float-label">Data da Amostra</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                                        formControlName="dataDescarte" dateFormat="dd/mm/yy"
                                                                        inputId="float-label" [showIcon]="true" [disabled]="true">
                                                                    </p-datepicker>
                                                                    <label for="float-label">Data de Descarte</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11  text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select 
                                                                        inputId="float-label" 
                                                                        [style]="{'width':'100%'}"
                                                                        [options]="finalidades" 
                                                                        formControlName="finalidade"
                                                                        optionLabel="nome" 
                                                                        optionValue="nome" appendTo="body"
                                                                        [filter]="true" 
                                                                        filterBy="nome"
                                                                        [editable]="true" 
                                                                        [showClear]="true">
                                                                    </p-select>
                                                                    <label for="float-label">Selecione a Finalidade</label>
                                                                </p-floatLabel>
                                                            </div>
                    
                                                            <div class="w-11" *ngIf="registerForm.get('finalidade')?.value === 'SAC'">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="numeroSac"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">N° SAC</label>
                                                                </p-floatlabel>
                                                            </div>
                    
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="numero"
                                                                            [readOnly]="true" type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Número</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="numeroLote"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Número Lote</label>
                                                                </p-floatlabel>
                                                            </div>
                    
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                                        [options]="status" formControlName="status" optionLabel="nome"
                                                                        optionValue="nome" appendTo="body" [filter]="true" filterBy="nome"
                                                                        [showClear]="true">
                                                                    </p-select>
                                                                    <label for="float-label">Classificação</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                                        [options]="locaisColeta" formControlName="localColeta"
                                                                        optionLabel="nome" optionValue="nome" appendTo="body"
                                                                        [filter]="true" filterBy="nome" [showClear]="true">
                                                                    </p-select>
                                                                    <label for="float-label">Local de Coleta</label>
                                                                </p-floatLabel>
                                                            </div>
                                    
                                                            <div class = "text-left">
                                                                <div class="buttons flex flex-wrap md:flex-row justify-content-around" >
                        
                                                                    <p-inplace closable="true" closeIcon="pi pi-angle-up">
                                                                        <ng-template pTemplate="display">
                                                                            <p-button 
                                                                                label="Inserir Imagens" severity="info"
                                                                                tooltipPosition="top"
                                                                                pTooltip="Inserir Imagens"
                                                                            >
                                                                                <div class="inline-flex align-items-center">
                                                                                    <span><i class="pi pi-plus"></i></span>
                                                                                </div>
                                                                            </p-button>
                                                                        </ng-template>
                                                                        <ng-template pTemplate="content">
                                                                            <div class="step1 w-12">
                                                                                <nz-upload nzType="drag" [nzMultiple]="true"
                                                                                    [nzAction]="undefined" [nzCustomRequest]="customRequest"
                                                                                    (nzChange)="handleChange($event)" [nzFileList]="[]"
                                                                                    [nzShowUploadList]="false">
                        
                                                                                    <p class="ant-upload-drag-icon">
                                                                                        <nz-icon nzType="inbox" />
                                                                                    </p>
                                                                                    <p class="ant-upload-text">Click ou arraste os arquivos para
                                                                                        fazer upload das imagens</p>
                                                                                    <p class="ant-upload-hint">
                                                                                        Formatos aceitos: JPG, PNG, GIF (máx. 5MB cada). As
                                                                                        imagens serão enviadas ao salvar a amostra.
                                                                                    </p>
                        
                                                                                </nz-upload>
                        
                                                                                <!-- Lista dos arquivos selecionados FORA do nz-upload -->
                                                                                <div *ngIf="uploadedFilesWithInfo.length > 0"
                                                                                    class="mt-3 custom-file-list">
                                                                                    <h4>Arquivos selecionados ({{ uploadedFilesWithInfo.length
                                                                                        }}):</h4>
                                                                                    <div *ngFor="let fileInfo of uploadedFilesWithInfo; let i = index"
                                                                                        class="flex flex-column p-3 border-1 border-round mb-2 bg-white gap-2 shadow-1">
                        
                                                                                        <!-- Informações do arquivo -->
                                                                                        <div
                                                                                            class="flex align-items-center justify-content-between">
                                                                                            <div class="flex align-items-center gap-2">
                                                                                                <i class="pi pi-file-image text-blue-500"></i>
                                                                                                <span class="font-medium">{{ fileInfo.file.name
                                                                                                    }}</span>
                                                                                                <small class="text-gray-500">({{
                                                                                                    (fileInfo.file.size / 1024 /
                                                                                                    1024).toFixed(2) }}MB)</small>
                                                                                            </div>
                                                                                            <p-button icon="pi pi-times" severity="danger"
                                                                                                [rounded]="true" size="small" [text]="true"
                                                                                                (onClick)="removeFile(i)"
                                                                                                pTooltip="Remover arquivo">
                                                                                            </p-button>
                                                                                        </div>
                        
                                                                                        <!-- Campo de descrição -->
                                                                                        <div class="w-full">
                                                                                            <p-floatLabel variant="on">
                                                                                                <input pInputText [value]="fileInfo.descricao"
                                                                                                    (input)="onDescricaoInput(i, $event)"
                                                                                                    (blur)="onDescricaoInput(i, $event)"
                                                                                                    type="text" [id]="'descricao-' + i"
                                                                                                    [style]="{'width':'100%'}"
                                                                                                    autocomplete="off" variant="filled" />
                                                                                                <label [for]="'descricao-' + i">Descrição da
                                                                                                    imagem (opcional)</label>
                                                                                            </p-floatLabel>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </ng-template>
                                                                    </p-inplace>
                                                                </div>    
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--CARD 2-->
                                                    <div class="bloco w-4 text-center">
                                                        <div class="titulo titulo-material">
                                                            Material
                                                        </div>
                                                        <div class="flex flex-column align-items-center w-12 gap-3">
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select 
                                                                        inputId="float-label" 
                                                                        [style]="{'width':'100%'}" 
                                                                        [options]="materiais" 
                                                                        formControlName="material"
                                                                        optionLabel="value" 
                                                                        optionValue="value" 
                                                                        appendTo="body" 
                                                                        [filter]="true" 
                                                                        filterBy="value" 
                                                                        [showClear]="true"
                                                                        (onChange)="onMaterialChange($event.value)">
                                                                    </p-select>
                                                                    <label for="float-label">Selecione o Material</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select 
                                                                        inputId="float-label" 
                                                                        [style]="{'width':'100%'}"
                                                                        [options]="produtosFiltrados" 
                                                                        formControlName="produtoAmostra"
                                                                        optionLabel="nome" 
                                                                        optionValue="id" 
                                                                        appendTo="body" 
                                                                        [filter]="true"
                                                                        filterBy="nome" 
                                                                        [showClear]="true" 
                                                                        (onChange)="onProdutoAmostraChange($event.value)">
                                                                    </p-select>
                                                                    <label for="float-label">Produto da Amostra</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="tipoAmostra"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Digite o Tipo</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="subtipo"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Digite o Subtipo</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11" *ngIf="registerForm.get('material')?.value === 'Aditivos'">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="estadoFisico"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Estado Físico</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div *ngIf="registerForm.get('material')?.value === 'Argamassa'" class="w-12 text-left">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input
                                                                            variant="filled"
                                                                            [style]="{'width':'100%'}"
                                                                            pInputText id="on_label"
                                                                            autocomplete="off"
                                                                            formControlName="codDb"
                                                                            type="text"
                                                                        />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Digite o código DB</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select 
                                                                        inputId="float-label" [style]="{'width':'100%'}"
                                                                        [options]="fornecedores" 
                                                                        formControlName="fornecedor"
                                                                        optionLabel="nome" 
                                                                        optionValue="nome" 
                                                                        appendTo="body"
                                                                        [filter]="true" 
                                                                        filterBy="nome" 
                                                                        [showClear]="true"
                                                                        [editable]="true"
                                                                    >
                                                                    </p-select>
                                                                    <label for="float-label">Fornecedor</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input 
                                                                            variant="filled" 
                                                                            [style]="{'width':'100%'}" 
                                                                            pInputText
                                                                            id="on_label" 
                                                                            autocomplete="off" 
                                                                            formControlName="periodoHora"
                                                                            type="time" 
                                                                            min="00:00"
                                                                            max="23:59"
                                                                            value="00:00"
                                                                        />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Digite o Período Hora</label>
                                                                </p-floatlabel>
                                                            </div>
                    
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                                        [options]="periodos" formControlName="periodoTurno"
                                                                        optionLabel="nome" optionValue="id" appendTo="body" [filter]="true"
                                                                        filterBy="nome" [showClear]="true">
                                                                    </p-select>
                                                                    <label for="float-label">Periodicidade</label>
                                                                </p-floatLabel>
                                                            </div>
                    
                                                        </div>
                    
                                                        <div class="flex flex-column align-items-center mt-3 w-12 gap-3">
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                                        [options]="tipos" formControlName="tipoAmostragem"
                                                                        optionLabel="value" optionValue="value" appendTo="body"
                                                                        [filter]="true" filterBy="value" [showClear]="true">
                                                                    </p-select>
                                                                    <label for="float-label">Tipo de Amostragem</label>
                                                                </p-floatLabel>
                                                            </div>
                                                        </div>
                                                        <div class="flex flex-column w-12 gap-3 lg:w-12 lg:flex-row">
                                                            <div *ngIf="exibirRepresentatividadeLote()" class=" w-12 mt-3">
                                                                <p-floatLabel variant="on">
                                                                    <input pInputText formControlName="representatividadeLote" type="text"
                                                                        id="representatividadeLote" [style]="{'width':'100%'}"
                                                                        autocomplete="off" variant="filled" [readOnly]="false" />
                                                                    <label>Representatividade do Lote Tn</label>
                                                                </p-floatLabel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--CARD3-->
                                                    <div class="bloco w-4 text-center">
                                                        <div class="titulo titulo-complementos">
                                                            Complementos
                                                        </div>
                                                        <div class="flex flex-column align-items-center w-12 gap-3">
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="registroEp"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Registro Empresa</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off"
                                                                            formControlName="registroProduto" type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Registro Produto</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatLabel variant="on">
                                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                                        formControlName="dataEnvio" dateFormat="dd/mm/yy"
                                                                        inputId="float-label" [showIcon]="true">
                                                                    </p-datepicker>
                                                                    <label for="float-label">Data de Envio</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatlabel variant="on">
                                                                    <p-iconfield>
                                                                        <p-inputicon class="pi pi-file-edit" />
                                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                                            id="on_label" autocomplete="off" formControlName="destinoEnvio"
                                                                            type="text" />
                                                                    </p-iconfield>
                                                                    <label for="on_label">Digite o Destino do Envio</label>
                                                                </p-floatlabel>
                                                            </div>
                                                            <div class="w-11">
                                                                <p-floatLabel variant="on">
                                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                                        formControlName="dataRecebimento" dateFormat="dd/mm/yy"
                                                                        inputId="float-label" [showIcon]="true">
                                                                    </p-datepicker>
                                                                    <label for="float-label">Data de Recebimento</label>
                                                                </p-floatLabel>
                                                            </div>
                    
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <input pInputText formControlName="identificacaoComplementar"
                                                                        type="text" id="identificacaoComplementar"
                                                                        [style]="{'width':'100%'}" autocomplete="off" variant="filled" />
                                                                    <label>Identificação Complementar</label>
                                                                </p-floatLabel>
                                                            </div>
                    
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <input pInputText formControlName="complemento" type="text"
                                                                        id="complemento" [style]="{'width':'100%'}" autocomplete="off"
                                                                        variant="filled" />
                                                                    <label>Complemento</label>
                                                                </p-floatLabel>
                                                            </div>
                    
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <input pInputText formControlName="observacoes" type="text"
                                                                        id="complemento" [style]="{'width':'100%'}" autocomplete="off"
                                                                        variant="filled" />
                                                                    <label>Observações</label>
                                                                </p-floatLabel>
                                                            </div>
                                                            <div class="w-11 text-left">
                                                                <p-floatLabel variant="on">
                                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                                        [options]="reter" formControlName="reter" optionLabel="nome"
                                                                        optionValue="value" appendTo="body" [filter]="true" filterBy="value"
                                                                        [showClear]="true">
                                                                    </p-select>
                                                                    <label for="float-label">Reter</label>
                                                                </p-floatLabel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                    
                                            </form>
                                        </div>
                    
                                        <div class="step1 flex flex-column w-12 gap-3 mb-5 mt-5 justify-content-end lg:w-12 lg:flex-row">
                                           
                                            <div class=" flex w-6 gap-3 justify-content-end text-right">
                                                <p-button 
                                                    (onClick)="navegarParaOs()" 
                                                    label="Abrir OS"
                                                    severity="info"
                                                    icon="pi pi-arrow-right" 
                                                    iconPos="right"  
                                                    tooltipPosition="top"
                                                    pTooltip="Verifique se os campos estão preenchidos!"
                                                />
                                                <p-button 
                                                    (onClick)="submitAmostra()" 
                                                    label="Salvar Amostra" 
                                                    severity="success"
                                                    icon="pi pi-check" 
                                                    iconPos="right" 
                                                    tooltipPosition="top"
                                                    pTooltip="Salvar Amostra"
                                                />
                                            </div>
                                        </div>
                                        <div class="step1 mt-4">
                                            <div class="text-left w-12">
                                                <p-toast />
                                                <p-confirmDialog />
                                                <p-inplace closable="true" closeIcon="pi pi-angle-up">
                                                    <ng-template pTemplate="display">
                                                        <p-button 
                                                            label="Amostras" 
                                                            tooltipPosition="top"
                                                            pTooltip="Exibir Amostras"
                                                            severity="info"      
                                                        >
                                                            <div class="inline-flex align-items-center">
                                                                <span><i class="pi pi-angle-down"></i></span>
                                                            </div>
                                                        </p-button>
                    
                                                    </ng-template>
                                                    <ng-template pTemplate="content">
                                                        <p-table 
                                                            [value]="amostras" 
                                                            [paginator]="true" [rows]="10"
                                                            [rowsPerPageOptions]="[10, 20, 50]"
                                                            [globalFilterFields]="['data_entrada','data_coleta','produto_amostra','numero','material','tipo_amostra','status','local_coleta']"
                                                            [showCurrentPageReport]="true"
                                                            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} Ordens"
                                                            scrollable="true"       
                                                            sortField="id"
                                                            [sortOrder]="-1"   
                                                            #dt1
                                                        >
                                                            <ng-template pTemplate="caption">
                                                                <div class="flex flex-row md: justify-content-end">
                                                                    <p-floatlabel variant="on">
                                                                        <p-iconfield>
                                                                            <p-inputicon class="pi pi-search" style="color: #1b91ff;" />
                                                                            <input 
                                                                            variant="filled" 
                                                                            [(ngModel)]="inputValue"
                                                                            [style]="{'width':'100%'}" 
                                                                            pInputText id="on_label"
                                                                            autocomplete="off" 
                                                                            type="text" 
                                                                            (keydown)="filterTable()"
                                                                            />
                                                                        </p-iconfield>
                                                                        <label for="on_label" style="color: #1b91ff">Pesquisar</label>
                                                                    </p-floatlabel>
                                                                </div>
                                                            </ng-template>
                                                            <ng-template pTemplate="header">
                                                                <tr class="tabela">
                                                                    <th>
                                                                        <p-columnFilter field="material" matchMode="in" [showMenu]="false">
                                                                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                                                                <p-multiselect 
                                                                                    [ngModel]="value" 
                                                                                    [options]="materiaisFiltro" 
                                                                                    (onChange)="filter($event.value)" 
                                                                                    placeholder="Filtrar o Material" 
                                                                                    [showClear]="true" 
                                                                                    optionLabel="label"
                                                                                    optionValue="value"
                                                                                    [maxSelectedLabels]="3"
                                                                                    appendTo="body"
                                                                                >
                                                                                    <ng-template pTemplate="selectedItems" let-selectedOptions>
                                                                                        <div class="flex gap-1 flex-wrap">
                                                                                            <p-tag 
                                                                                                *ngFor="let option of selectedOptions" 
                                                                                                [value]="option.label" 
                                                                                                [severity]="getSeverity(option.value)" />
                                                                                        </div>
                                                                                    </ng-template>
                                                                                    <ng-template pTemplate="item" let-option>
                                                                                        <p-tag [value]="option.label" [severity]="getSeverity(option.value)" />
                                                                                    </ng-template>
                                                                                </p-multiselect>
                                                                            </ng-template>
                                                                        </p-columnFilter>
                                                                    </th>
                                                                    
                                                                    <th pSortableColumn="data_entrada" style="min-width: 10rem">
                                                                        <div class="flex justify-between items-center">
                                                                            Data Entrada
                                                                            <p-sortIcon field="data_entrada" />
                                                                            <p-columnFilter type="date" field="data_entrada" display="menu"  class="ml-auto" showMenu="false" />
                                                                        </div>
                                                                    </th>
                                                                    <th pSortableColumn="data_coleta" style="min-width: 10rem">
                                                                        <div class="flex justify-between items-center">
                                                                            Data Coleta
                                                                            <p-sortIcon field="data_coleta" />
                                                                            <p-columnFilter type="date" field="data_coleta" display="menu"  class="ml-auto" showMenu="false" />
                                                                        </div>
                                                                    </th>
                                                                    <th style="width: 15%; text-align: center;" type="text" field="numero" display="menu">Número</th>
                                                                    <th style="width: 10%; text-align: center;" type="text" field="finalidade" display="finalidade">Finalidade</th>
                                                                    <th style="width: 10%; text-align: center;" type="text" field="produto_amostra" display="menu">Produto Amostra</th>
                                                                    <th style="width: 15%; text-align: center;" type="text"field="fornecedor" display="menu">Fornecedor</th>
                                                                    <th style="width: 15%; text-align: center;" type="text"field="local_coleta" display="menu">Local de Coleta</th>
                                                                    <th style="width: 10%; text-align: center;" type="text"field="status" display="menu">Status</th>
                                                                    <th style="width: 10%; text-align: center;" type="text" field="acoes"display="menu">Opções</th>
                                                                </tr>
                                                            </ng-template>

                                                            <ng-template pTemplate="body" let-amostra>
                                                                <tr>
                                                                    <td style="text-align: center;">
                                                                        <p-tag 
                                                                            [value]="amostra?.material"
                                                                            [severity]="getSeverity(amostra?.material)"
                                                                        />
                                                                    </td>
                                                                    <td style="text-align: center;">{{ amostra?.data_entrada | date:'dd/MM/yyyy' }}</td>
                                                                    <td style="text-align: center;">{{ amostra?.data_coleta | date:'dd/MM/yyyy' }}</td>   
                                                                    <td style="text-align: center;">{{ amostra?.numero }}</td>
                                                                    <td style="text-align: center;">{{ amostra?.finalidade }}</td>
                                                                    <td style="text-align: center;">{{ amostra?.produto_amostra_detalhes?.nome }}</td>
                                                                    <td style="text-align: center;">{{ amostra?.fornecedor }}</td>
                                                                    <td style="text-align: center;">{{ amostra?.local_coleta }}</td>
                                                                    <td style="text-align: center;">{{ amostra?.status }}</td>
                                                                    <td style="text-align: center;">
                                                                        <div style="display: flex; justify-content: end;">
                                                                            <p-speeddial 
                                                                                showIcon="pi pi-bars" hideIcon="pi pi-times"
                                                                                [model]="getMenuItems(amostra)"
                                                                                [radius]="80"
                                                                                type="quarter-circle" direction="up-left"
                                                                                [style]="{ position: 'relative', top: '0', right: 0 }" 
                                                                                [buttonProps]="{ severity: 'info', rounded: true }"
                                                                                [tooltipOptions]="{ tooltipPosition: 'bottom' }"
                                                                                pTooltip="Ações"
                                                                                tooltipPosition="top"
                                                                            ></p-speeddial>
                                                                            <p-button
                                                                                icon="pi pi-arrow-right"
                                                                                [rounded]="true"
                                                                                class="ml-1"
                                                                                tooltipPosition="top"
                                                                                severity="help"
                                                                                (onClick)="criarOrdemDeAmostra(amostra)"
                                                                                pTooltip="Abrir OS com plano fixo"
                                                                            ></p-button>
                                                                            <p-button 
                                                                                icon="pi pi-book" 
                                                                                [rounded]="true"
                                                                                severity="warn"
                                                                                class="ml-2"
                                                                                (onClick)="criarExpressaDeAmostra(amostra)"
                                                                                tooltipPosition="top"
                                                                                pTooltip="OS Expressa"
                                                                            ></p-button>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                
                                                            </ng-template>
                                                        </p-table>
                    
                                                    </ng-template>
                                                </p-inplace>
                                            </div>
                                        </div>
                                    </ng-template>
                                </p-step-panel>
                                
                                <p-step-panel [value]="2">
                                    <ng-template #content let-activateCallback="activateCallback">
                                        <div class="form-geral mb-6 flex flex-column align-items-center">
                                            <div class="button-imprimir flex flex-wrap mt-6 mb-6 md:flex-row justify-content-around" (click)="imprimirEtiquetaForm()">
                                                <!-- <div *ngIf="hasGroup(['Admin','Master','RHGestor'])" routerLink="../feedback"> -->
                                                <div *ngIf="hasGroup(['Admin','Master','RHGestor'])">
                                                    <p> Imprimir Etiqueta </p>
                                                </div>  
                                            </div>    
                                        </div>
                                        <div class="flex flex-column w-12 gap-3 mb-3 justify-content-end lg:w-12 lg:flex-row">
                                            <div class="w-4 text-left">
                                                <p-button 
                                                    title="Voltar" 
                                                    label="Voltar" 
                                                    severity="warn" 
                                                    icon="pi pi-arrow-left"
                                                    (onClick)="activateCallback(1)"
                                                />
                                            </div>

                                            <div class="w-4 text-center">
                                               <p-button 
                                                    (onClick)="navegarParaExpressa()" 
                                                    severity="danger" 
                                                    label="OS Expressa"
                                                    icon="pi pi-book" 
                                                    iconPos="right"  
                                                    tooltipPosition="top"
                                                    pTooltip="OS Expressa"
                                                />
                                            </div>


                                            <div class=" flex w-4 gap-3 justify-content-end text-right">
                                                <p-button 
                                                    title="OS Com Plano" 
                                                    label="OS Com Plano" 
                                                    severity="success" 
                                                    icon="pi pi-arrow-right" 
                                                    iconPos="right"
                                                    (onClick)="receberDadosAmostra()"
                                                />
                                            </div>
                                        
                                        </div> 
                                    </ng-template>
                                </p-step-panel>

                                <p-step-panel [value]="3">
                                    <p-toast/>
                                    <ng-template #content let-activateCallback="activateCallback">
                                        <form [formGroup]="registerOrdemForm" title="Cadastrar nova Ordem de Serviço"
                                            class="flex flex-column gap-4">
                                            <div class="form-geral flex flex-column align-items-center" @swipeAnimation>
                                              <div class="bloco w-12 text-center">
                                                    <div class="titulo titulo-custom mt-3" type="solid" class="divider-custom">
                                                        <b>Ordem de Serviço</b>
                                                    </div>
                                                <div class="flex flex-column justify-content-center w-12 mt-3 gap-3 lg:flex-row">
                                                    <div class="w-5">
                                                        <p-floatlabel variant="on">
                                                            <p-iconfield>
                                                                <p-inputicon class="pi pi-file-edit" />
                                                                <input variant="filled" [style]="{'width':'100%'}" pInputText id="on_label"
                                                                    autocomplete="off" formControlName="numero" type="text" />
                                                            </p-iconfield>
                                                            <label for="on_label">Número</label>
                                                        </p-floatlabel>
                                                    </div>
                                                    <div class="w-5">
                                                        <p-floatlabel variant="on">
                                                            <p-iconfield>
                                                                <p-inputicon class="pi pi-file-edit" />
                                                                <input variant="filled" [style]="{'width':'100%'}" pInputText id="on_label"
                                                                    autocomplete="off" formControlName="digitador" type="text" />
                                                            </p-iconfield>
                                                            <label for="on_label">Digitador</label>
                                                        </p-floatlabel>
                                                    </div>
                    
                                                </div>
                                                <div class="flex flex-column justify-content-center w-12 gap-3 lg:flex-row">
                                                    <div class="w-5 text-left mb-3 mt-3">
                                                        <p-floatLabel variant="on">
                                                            <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                                formControlName="data" dateFormat="dd/mm/yy" inputId="float-label"
                                                                [showIcon]="true">
                                                            </p-datepicker>
                                                            <label for="float-label">Data de Abertura</label>
                                                        </p-floatLabel>
                                                    </div>
                                                    <div class="w-5 text-left mb-3 mt-3">
                                                        <p-floatLabel variant="on">
                                                            <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                                [options]="planosAnalise" formControlName="planoAnalise"
                                                                optionLabel="descricao" optionValue="id" appendTo="body" [filter]="true"
                                                                filterBy="nome" [showClear]="true"
                                                            >
                                                            </p-select>
                                                            <label for="float-label">Selecione o Plano de Análise</label>
                                                        </p-floatLabel>
                                                    </div>
                    
                    
                                                </div>
                                             
                                                <div class="flex flex-column justify-content-center w-12 gap-3 mb-3 justify-content-end lg:flex-row">
                                                    <div class="w-5 text-left ">
                                                        <p-button 
                                                            title="Voltar"
                                                            label="Voltar" 
                                                            severity="warn" 
                                                            icon="pi pi-arrow-left"
                                                            (onClick)="voltarParaStep2()"
                                                        />
                                                    </div>
                                                    <div class="flex w-5 gap-3 justify-content-end text-right">
                                                        <p-button 
                                                            label="Gerar OS" 
                                                            severity="success" 
                                                            icon="pi pi-check" 
                                                            iconPos="right"
                                                            (onClick)="criarOSDoFormulario()" />
                                                    </div>
                                                </div>
                                              </div>
                                            </div>
                                        </form>
                                    </ng-template>
                                </p-step-panel>
                            
                            </p-step-panels>
                        </p-stepper>
                    </p-card>
                </div>
            </div>
        </div>
                
    </div>
        
</div>          

    <!---------------------------------Modal Edição---------------------------------------------->
    <p-drawer
        [(visible)]="editFormVisible"
        position="bottom"
        [style]="{ height: '100vh' }"
        styleClass="w-full md:w-12 lg:w-12 pb-0 "
    >

        <div class="step1 w-12 pt-0 mt-0">
            <div class="background-form">
                <form
                    [formGroup]="editForm" title="Editar Amostra" class="flex flex-column gap-4" 
                >
                    <div class="form-geral flex flex-column gap-3 w-12 lg:flex-row">
                        <div class="fg1 flex flex-column w-12 align-items-center">

                            <div class="bloco w-12 text-center pb-0">
                                <div class="titulo titulo-info">
                                    <div class="header titulo-info w-full text-left pb-0">
                                        <b>Editar Amostra</b>
                                    </div>
                                </div>
                                <div class="form-geral flex flex-column gap-3 w-12 lg:flex-row" >
                                    <p-card class="card w-4 text-center pb-0" >
                                       <ng-template #header>
                                            <p-divider type="solid" class="divider-custom2">
                                                <b>Informações Gerais</b>
                                            </p-divider>
                                        </ng-template>
                                        <div class="bloco flex flex-column w-12 gap-3 lg:w-12">
                                            <div class="w-12">
                                                <p-floatLabel variant="on">
                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                        formControlName="dataEntrada" dateFormat="dd/mm/yy"
                                                        inputId="float-label" [showIcon]="true">
                                                    </p-datepicker>
                                                    <label for="float-label">Data de Entrada</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12 pb-0">
                                                <p-floatLabel variant="on">
                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                        formControlName="dataColeta" dateFormat="dd/mm/yy"
                                                        inputId="float-label" [showIcon]="true">
                                                    </p-datepicker>
                                                    <label for="float-label">Data da Amostra</label>
                                                </p-floatLabel>
                                            </div>
    
                                            <div class="w-12  text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="finalidades" formControlName="finalidade"
                                                        optionLabel="nome" optionValue="nome" appendTo="body"
                                                        [filter]="true" filterBy="value" [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Selecione a Finalidade</label>
                                                </p-floatLabel>
                                            </div>
    
                                            <div class="w-12" *ngIf="editForm.get('finalidade')?.value === 'SAC'">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="numeroSac"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">N° SAC</label>
                                                </p-floatlabel>
                                            </div>
    
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="numero"
                                                            [readOnly]="true" type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Número</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="numeroLote"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Número Lote</label>
                                                </p-floatlabel>
                                            </div>
    
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="status" formControlName="status" optionLabel="nome"
                                                        optionValue="nome" appendTo="body" [filter]="true" filterBy="value"
                                                        [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Classificação</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="locaisColeta" formControlName="localColeta"
                                                        optionLabel="nome" optionValue="nome" appendTo="body"
                                                        [filter]="true" filterBy="value" [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Local de Coleta</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class = "text-left">
                                                <div class="buttons flex flex-wrap md:flex-row justify-content-around" >
        
                                                    <p-inplace closable="true" closeIcon="pi pi-angle-up">
                                                        <ng-template pTemplate="display">
                                                            <p-button 
                                                                label="Inserir Imagens" severity="info"
                                                                tooltipPosition="top"
                                                                pTooltip="Inserir Imagens"
                                                            >
                                                                <div class="inline-flex align-items-center">
                                                                    <span><i class="pi pi-plus"></i></span>
                                                                </div>
                                                            </p-button>
                                                        </ng-template>
                                                        <ng-template pTemplate="content">
                                                            <div class="step1 w-12">
                                                                <nz-upload nzType="drag" [nzMultiple]="true"
                                                                    [nzAction]="undefined" [nzCustomRequest]="customRequest"
                                                                    (nzChange)="handleChange($event)" [nzFileList]="[]"
                                                                    [nzShowUploadList]="false">
        
                                                                    <p class="ant-upload-drag-icon">
                                                                        <nz-icon nzType="inbox" />
                                                                    </p>
                                                                    <p class="ant-upload-text">Click ou arraste os arquivos para
                                                                        fazer upload das imagens</p>
                                                                    <p class="ant-upload-hint">
                                                                        Formatos aceitos: JPG, PNG, GIF (máx. 5MB cada). As
                                                                        imagens serão enviadas ao salvar a amostra.
                                                                    </p>
        
                                                                </nz-upload>
        
                                                                <!-- Lista dos arquivos selecionados FORA do nz-upload -->
                                                                <div *ngIf="uploadedFilesWithInfo.length > 0"
                                                                    class="mt-3 custom-file-list">
                                                                    <h4>Arquivos selecionados ({{ uploadedFilesWithInfo.length
                                                                        }}):</h4>
                                                                    <div *ngFor="let fileInfo of uploadedFilesWithInfo; let i = index"
                                                                        class="flex flex-column p-3 border-1 border-round mb-2 bg-white gap-2 shadow-1">
        
                                                                        <!-- Informações do arquivo -->
                                                                        <div
                                                                            class="flex align-items-center justify-content-between">
                                                                            <div class="flex align-items-center gap-2">
                                                                                <i class="pi pi-file-image text-blue-500"></i>
                                                                                <span class="font-medium">{{ fileInfo.file.name
                                                                                    }}</span>
                                                                                <small class="text-gray-500">({{
                                                                                    (fileInfo.file.size / 1024 /
                                                                                    1024).toFixed(2) }}MB)</small>
                                                                            </div>
                                                                            <p-button icon="pi pi-times" severity="danger"
                                                                                [rounded]="true" size="small" [text]="true"
                                                                                (onClick)="removeFile(i)"
                                                                                pTooltip="Remover arquivo">
                                                                            </p-button>
                                                                        </div>
        
                                                                        <!-- Campo de descrição -->
                                                                        <div class="w-full">
                                                                            <p-floatLabel variant="on">
                                                                                <input pInputText [value]="fileInfo.descricao"
                                                                                    (input)="onDescricaoInput(i, $event)"
                                                                                    (blur)="onDescricaoInput(i, $event)"
                                                                                    type="text" [id]="'descricao-' + i"
                                                                                    [style]="{'width':'100%'}"
                                                                                    autocomplete="off" variant="filled" />
                                                                                <label [for]="'descricao-' + i">Descrição da
                                                                                    imagem (opcional)</label>
                                                                            </p-floatLabel>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </ng-template>
                                                    </p-inplace>
                                                </div>    
                                                
                                            </div>
                                        </div>
                                    </p-card>
    
                                    <p-card class="card w-4 text-center pb-0">
                                        <ng-template #header>
                                            <p-divider type="solid" class="divider-custom2">
                                                <b>Material</b>
                                            </p-divider>
                                        </ng-template>
                                        <div class="flex flex-column w-12 gap-3">
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select 
                                                        inputId="float-label" 
                                                        [style]="{'width':'100%'}" 
                                                        [options]="materiais" 
                                                        formControlName="material"
                                                        optionLabel="value" 
                                                        optionValue="value" 
                                                        appendTo="body" 
                                                        [filter]="true" 
                                                        filterBy="value" 
                                                        [showClear]="true"
                                                        (onChange)="onMaterialChange($event.value)">
                                                    </p-select>
                                                    <label for="float-label">Selecione o Material</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="produtosFiltrados" formControlName="produtoAmostra"
                                                        optionLabel="nome" optionValue="id" appendTo="body" [filter]="true"
                                                        filterBy="value" [showClear]="true" [editable]="true"
                                                        (onChange)="onProdutoAmostraChange($event.value)">
                                                    </p-select>
                                                    <label for="float-label">Produto de Amostra</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="tipoAmostra"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Digite o Tipo</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="subtipo"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Digite o Subtipo</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12" *ngIf="registerForm.get('material')?.value === 'Aditivos'">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="estadoFisico"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Estado Físico</label>
                                                </p-floatlabel>
                                            </div>
                                            <div *ngIf="registerForm.get('material')?.value === 'Argamassa'" class="w-12 text-left">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input
                                                            variant="filled"
                                                            [style]="{'width':'100%'}"
                                                            pInputText id="on_label"
                                                            autocomplete="off"
                                                            formControlName="codDb"
                                                            type="text"
                                                        />
                                                    </p-iconfield>
                                                    <label for="on_label">Digite o código DB</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="fornecedores" formControlName="fornecedor"
                                                        optionLabel="nome" optionValue="nome" appendTo="body"
                                                        [filter]="true" filterBy="value" [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Fornecedor</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input 
                                                            variant="filled" 
                                                            [style]="{'width':'100%'}" 
                                                            pInputText
                                                            id="on_label" 
                                                            autocomplete="off" formControlName="periodoHora"
                                                            type="time" 
                                                            min="00:00"
                                                            max="23:59"
                                                            value="00:00"
                                                        />
                                                    </p-iconfield>
                                                    <label for="on_label">Digite o Período Hora</label>
                                                </p-floatlabel>
                                            </div>
    
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="periodos" formControlName="periodoTurno"
                                                        optionLabel="nome" optionValue="id" appendTo="nome" [filter]="true"
                                                        filterBy="value" [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Periodicidade</label>
                                                </p-floatLabel>
                                            </div>
    
                                        </div>
    
                                        <div class="flex flex-column mt-3 w-12 gap-3">
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="tipos" formControlName="tipoAmostragem"
                                                        optionLabel="value" optionValue="value" appendTo="body"
                                                        [filter]="true" filterBy="value" [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Tipo de Amostragem</label>
                                                </p-floatLabel>
                                            </div>
                                        </div>
                                        <div class="flex flex-column w-12 gap-3 lg:w-12 lg:flex-row">
                                            <div *ngIf="exibirRepresentatividadeLote()" class=" w-12 mt-3">
                                                <p-floatLabel variant="on">
                                                    <input pInputText formControlName="representatividadeLote" type="text"
                                                        id="representatividadeLote" [style]="{'width':'100%'}"
                                                        autocomplete="off" variant="filled" [readOnly]="false" />
                                                    <label>Representatividade do Lote Tn</label>
                                                </p-floatLabel>
                                            </div>
                                        </div>
                                    </p-card>
    
                                    <p-card class="card w-4 text-center pb-0">
                                        <ng-template #header>
                                            <p-divider type="solid" class="divider-custom2">
                                                <b>Complementos</b>
                                            </p-divider>
                                        </ng-template>
                                        <div class="flex flex-column w-12 gap-3">
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="registroEp"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Registro Empresa</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off"
                                                            formControlName="registroProduto" type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Registro Produto</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatLabel variant="on">
                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                        formControlName="dataEnvio" dateFormat="dd/mm/yy"
                                                        inputId="float-label" [showIcon]="true">
                                                    </p-datepicker>
                                                    <label for="float-label">Data de Envio</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatlabel variant="on">
                                                    <p-iconfield>
                                                        <p-inputicon class="pi pi-file-edit" />
                                                        <input variant="filled" [style]="{'width':'100%'}" pInputText
                                                            id="on_label" autocomplete="off" formControlName="destinoEnvio"
                                                            type="text" />
                                                    </p-iconfield>
                                                    <label for="on_label">Digite o Destino do Envio</label>
                                                </p-floatlabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatLabel variant="on">
                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                        formControlName="dataRecebimento" dateFormat="dd/mm/yy"
                                                        inputId="float-label" [showIcon]="true">
                                                    </p-datepicker>
                                                    <label for="float-label">Data de Recebimento</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatLabel variant="on">
                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                        formControlName="dataDescarte" dateFormat="dd/mm/yy"
                                                        inputId="float-label" [showIcon]="true" [disabled]="true">
                                                    </p-datepicker>
                                                    <label for="float-label">Data de Descarte (Calculada Automaticamente)</label>
                                                </p-floatLabel>
                                            </div>
    
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <input pInputText formControlName="identificacaoComplementar"
                                                        type="text" id="identificacaoComplementar"
                                                        [style]="{'width':'100%'}" autocomplete="off" variant="filled" />
                                                    <label>Identificação Complementar</label>
                                                </p-floatLabel>
                                            </div>
    
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <input pInputText formControlName="complemento" type="text"
                                                        id="complemento" [style]="{'width':'100%'}" autocomplete="off"
                                                        variant="filled" />
                                                    <label>Complemento</label>
                                                </p-floatLabel>
                                            </div>
    
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <input pInputText formControlName="observacoes" type="text"
                                                        id="complemento" [style]="{'width':'100%'}" autocomplete="off"
                                                        variant="filled" />
                                                    <label>Observações</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12 text-left">
                                                <p-floatLabel variant="on">
                                                    <p-select inputId="float-label" [style]="{'width':'100%'}"
                                                        [options]="reter" formControlName="reter" optionLabel="nome"
                                                        optionValue="value" appendTo="body" [filter]="true" filterBy="value"
                                                        [showClear]="true">
                                                    </p-select>
                                                    <label for="float-label">Reter</label>
                                                </p-floatLabel>
                                            </div>
                                            <div class="w-12">
                                                <p-floatLabel variant="on">
                                                    <p-datepicker variant="filled" [style]="{'width':'100%'}" id="da"
                                                        formControlName="dataDescarte" dateFormat="dd/mm/yy"
                                                        inputId="float-label" [showIcon]="true" [disabled]="true">
                                                    </p-datepicker>
                                                    <label for="float-label">Data de Descarte (Calculada Automaticamente)</label>
                                                </p-floatLabel>
                                            </div>
                                        </div>
                                    </p-card>

                                </div>
                                <div class=" flex w-12 gap-3 mt-4 justify-content-center text-center">
                                    <p-button 
                                        (onClick)="clearEditForm()" 
                                        label="Limpar"
                                        iconPos="right"  
                                        tooltipPosition="top"
                                        pTooltip="Limpar"
                                        icon="pi pi-eraser"
                                        severity="info"
                                    />
                                    
                                    <p-button 
                                        (onClick)="saveEdit()" 
                                        label="Salvar" 
                                        severity="success"
                                        icon="pi pi-save" 
                                        iconPos="right" 
                                        tooltipPosition="top"
                                        pTooltip="Salvar"
                                    />
                                </div>
                            </div>
                        </div>    
                    </div>
                </form>
            </div>
        </div>
    
    </p-drawer>

    <!---------------------------------Modal Visualização---------------------------------------------->
    <p-drawer 
        header="Visualizar Amostra" 
        [(visible)]="modalVisualizar" 
        position="left"
        styleClass="w-full md:w-10 lg:w-10 custom-drawer"
        [style]="{ height: '100vh' }"
        
    >
        <div *ngIf="amostraSelecionada" id="imprimir_visualizar">
            <p style="font-size: 24px; font-weight: bold">Informações Gerais: </p>

            <div class="form-geral flex flex-column gap-3 w-12 lg:flex-row">
                <div class="text-left w-6">
                    <b>Data de Entrada:</b> {{ amostraSelecionada.data_entrada | date:'dd/MM/yyyy'}}<br>
                    <b>Data de Coleta:</b> {{ amostraSelecionada.data_coleta | date:'dd/MM/yyyy' }}<br>
                    <b>Finalidade:</b> {{ amostraSelecionada.finalidade }}<br>
                    <b>N° SAC:</b> {{ amostraSelecionada.numero_sac }}
                </div>
                <div class="text-left w-6">
                    <b>Número:</b> {{ amostraSelecionada.numero }}<br>
                    <b>Número Lote:</b> {{ amostraSelecionada.numero_lote }}<br>
                    <b>Classificação:</b> {{ amostraSelecionada.status }}<br>
                    <b>Local de Coleta:</b> {{ amostraSelecionada.local_coleta }}
                </div>
            </div>
            <hr>
            <p style="font-size: 24px; font-weight: bold">Material: </p>
            <div class="form-geral flex flex-column gap-3 w-12 lg:flex-row">
                <div class="text-left w-6">
                    <b>Material:</b> {{ amostraSelecionada.material }}<br>
                    <b>Produto de Amostra:</b> {{ amostraSelecionada.produto_amostra_detalhes?.nome }}<br>
                    <b>Tipo:</b> {{ amostraSelecionada.produto_amostra_detalhes?.tipo }}<br>
                    <b>Subtipo:</b> {{ amostraSelecionada.produto_amostra_detalhes?.sub_tipo }}<br>
                    <b>Código DB:</b> {{ amostraSelecionada.cod_db }}
                </div>
                <div class="text-left w-6">
                    <b>Fornecedor:</b> {{ amostraSelecionada.fornecedor }}<br>
                    <b>Período Hora:</b> {{ amostraSelecionada.periodo_hora }}<br>
                    <b>Periodicidade:</b> {{ amostraSelecionada.periodo_turno }}<br>
                    <b>Tipo de Amostragem:</b> {{ amostraSelecionada.tipo_amostragem }}<br>
                    <b>Representatividade do Lote Tn:</b> {{ amostraSelecionada.representividade_lote }}
                </div>
            </div>
            <hr>
            <p style="font-size: 24px; font-weight: bold">Complementos: </p>
            <div class="form-geral flex flex-column gap-3 w-12 lg:flex-row">
                <div class="text-left w-6">
                    <b>Registro Empresa:</b> {{ amostraSelecionada.registro_ep }}<br>
                    <b>Registro Produto:</b> {{ amostraSelecionada.registro_produto }}<br>
                    <b>Data de Envio:</b> {{ amostraSelecionada.data_envio | date:'dd/MM/yyyy' }}<br>
                    <b>Destino do Envio:</b> {{ amostraSelecionada.destino_envio }}<br>
                    <b>Data de Recebimento:</b> {{ amostraSelecionada.data_recebida | date:'dd/MM/yyyy' }}
                </div>
                <div class="text-left w-6">
                    <b>Identificação Complementar:</b> {{ amostraSelecionada.identificacao_complementar }}<br>
                    <b>Complemento:</b> {{ amostraSelecionada.complemento }}<br>
                    <b>Observações:</b> {{ amostraSelecionada.observacoes }}<br>
                    <b>Reter:</b> {{ amostraSelecionada.reter ? 'Sim' : 'Não' }}
                </div>
            </div>

            <br>
            <br>
            <br>
            <br>

            <div class=" flex w-12 gap-3 justify-content-center text-center">
                <p-button 
                    (onClick)="imprimirAmostraVisualizar()" 
                    label="Imprimir" 
                    severity="warn"
                    icon="pi pi-print" 
                    iconPos="right" 
                    tooltipPosition="top"
                    pTooltip="Imprimir"
                />
            </div>

        </div>
    </p-drawer>

    <div class="container">

        <p-drawer 
        header="Imagens da Amostra" 
        [(visible)]="modalImagensVisible" 
        position="right" 
        [style]="{ width: '80vw' }">
        
        <div *ngIf="amostraImagensSelecionada" class="mb-4">
            <p style="font-size: 24px; font-weight: 400">Amostra: {{ amostraImagensSelecionada.numero }}</p>
            <p><strong>Material:</strong> {{ amostraImagensSelecionada.material }}</p>
            <p><strong>Data de Coleta:</strong> {{ amostraImagensSelecionada.data_coleta | date:'dd/MM/yyyy' }}</p>
        </div>

        <div *ngIf="imagensAmostra.length > 0" class="image-viewer">
            <!-- Navegação de imagens -->
            <div class="flex justify-content-between align-items-center mb-3">
            <p-button 
                icon="pi pi-chevron-left" 
                [disabled]="imagemAtualIndex === 0"
                (onClick)="imagemAnterior()"
                [rounded]="true">
            </p-button>
            
            <span class="text-lg font-semibold">
                {{ imagemAtualIndex + 1 }} de {{ imagensAmostra.length }}
            </span>
            
            <p-button 
                icon="pi pi-chevron-right" 
                [disabled]="imagemAtualIndex === imagensAmostra.length - 1"
                (onClick)="proximaImagem()"
                [rounded]="true">
            </p-button>
            </div>

            <!-- Imagem principal -->
            <div class="text-center mb-4">
            <img 
                [src]="imagensAmostra[imagemAtualIndex]?.image" 
                [alt]="imagensAmostra[imagemAtualIndex]?.descricao || 'Imagem da amostra'"
                style="max-width: 100%; max-height: 60vh; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            </div>

            <!-- Informações da imagem -->
            <div class="bg-gray-50 p-3 border-round mb-4">
            <p><strong>Descrição:</strong> {{ imagensAmostra[imagemAtualIndex]?.descricao || 'Sem descrição' }}</p>
            <p><strong>Data do Upload:</strong> {{ imagensAmostra[imagemAtualIndex]?.data_upload | date:'dd/MM/yyyy HH:mm' }}</p>
            <div class="bg-gray-50 p-3 border-round mb-4">
                <div class="w-full mb-3">
                    <p-floatLabel variant="on">
                        <input 
                            pInputText 
                            [(ngModel)]="imagensAmostra[imagemAtualIndex].descricao" 
                            type="text" 
                            id="edit-descricao"
                            [style]="{'width':'100%'}" 
                            autocomplete="off" 
                            variant="filled"
                            (ngModelChange)="onDescricaoChange(imagensAmostra[imagemAtualIndex])"
                        />
                        <label for="edit-descricao">Descrição da imagem</label>
                    </p-floatLabel>
                </div>
                <p><strong>Data do Upload:</strong> {{ imagensAmostra[imagemAtualIndex]?.data_upload | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            </div>

            <!-- Ações da imagem -->
            <div class="flex justify-content-center gap-2 mb-4">
            <p-button 
                label="Download" 
                icon="pi pi-download" 
                severity="info"
                (onClick)="downloadImagem(imagensAmostra[imagemAtualIndex])">
            </p-button>
            
            <p-button 
                label="Deletar" 
                icon="pi pi-trash" 
                severity="danger"
                (onClick)="deletarImagem(imagensAmostra[imagemAtualIndex].id)">
            </p-button>
            </div>

            <!-- Thumbnails (miniaturas) -->
            <div class="flex flex-wrap gap-2 justify-content-center" *ngIf="imagensAmostra.length > 1">
            <div 
                *ngFor="let imagem of imagensAmostra; let i = index"
                class="cursor-pointer border-2 border-round overflow-hidden"
                [class.border-primary]="i === imagemAtualIndex"
                [class.border-gray-300]="i !== imagemAtualIndex"
                (click)="irParaImagem(i)"
                style="width: 80px; height: 80px;">
                <img 
                [src]="imagem.image" 
                [alt]="'Miniatura ' + (i + 1)"
                style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            </div>
        </div>

        <!-- Mensagem quando não há imagens -->
        <div *ngIf="imagensAmostra.length === 0" class="text-center p-5">
            <i class="pi pi-images text-6xl text-gray-400 mb-3"></i>
            <p class="text-xl text-gray-600">Esta amostra não possui imagens anexadas.</p>
        </div>
        </p-drawer>

        <p-drawer header="Adicionar Imagens" [(visible)]="modalImagens" position="right" [style]="{ width: '40vw' }">

            
        </p-drawer>

    </div>

